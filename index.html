<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chlorophyll vs Hemoglobin: A Structural Comparison</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Align items from the top */
            min-height: 100vh;
            background: linear-gradient(to bottom right, #e0f7fa, #80cbc4); /* Cool blue-green gradient */
            color: #333;
            overflow-x: hidden; /* Prevent horizontal scroll */
            margin: 0;
            padding: 20px;
            padding-bottom: 50px; /* Add some padding at the bottom */
            box-sizing: border-box;
        }

        h1, p {
            text-align: center;
            margin-bottom: 15px;
            color: #004d40;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align top initially */
            gap: 50px; /* Space between molecules */
            width: 100%;
            max-width: 1200px;
            margin-top: 20px;
            position: relative; /* Needed for absolute positioning of hemoglobin */
        }

        .molecule-container {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            text-align: center;
            transition: box-shadow 0.3s ease;
            position: relative; /* Needed for absolute positioning */
            width: 500px; /* Fixed width, increased for more detailed diagrams */
            height: 650px; /* Fixed height, increased */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            box-sizing: border-box; /* Include padding in width/height */
            overflow: hidden; /* Hide overflow from SVG */
        }

        .molecule-container h2 {
            color: #00695c;
            margin-top: 0;
            margin-bottom: 20px;
        }

        .molecule-container svg {
            width: 100%;
            height: auto;
            max-height: 550px; /* Limit SVG height */
            display: block;
            margin: auto;
            overflow: visible; /* Allow elements slightly outside viewBox */
        }

        #hemoglobin-container {
            cursor: grab;
            position: absolute; /* Make draggable element absolute */
            z-index: 10; /* Ensure it's on top when dragging */
             /* Initial position will be set by JS on load */
            transition: none; /* Remove default transition initially */
        }

        #hemoglobin-container.dragging {
            cursor: grabbing;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        #hemoglobin-container.snapped {
             cursor: default;
             transition: left 0.5s ease-out, top 0.5s ease-out, box-shadow 0.5s ease; /* Smooth snap transition */
             box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2); /* Reset shadow after snap */
             z-index: 5; /* Can go below chlorophyll after snap */
        }


        /* SVG Styling */
        .bond {
            stroke: #000; /* Black bonds */
            stroke-width: 2;
            fill: none;
            transition: stroke 0.5s ease-out, stroke-width 0.5s ease-out; /* Transition for highlighting */
            stroke-linecap: round; /* Nicer look for bond ends */
        }

         /* Style for double bonds (offset lines) */
         .double-bond {
             stroke: #000; /* Black */
             stroke-width: 2;
             fill: none;
             transition: stroke 0.5s ease-out;
             stroke-linecap: round;
         }


        .atom-label {
            fill: #000; /* Black text for atom labels */
            font-size: 14px;
            text-anchor: middle;
            dominant-baseline: central;
            pointer-events: none; /* Don't interfere with dragging */
            transition: fill 0.5s ease-out; /* Transition for highlighting */
             font-weight: bold; /* Make important atoms stand out */
        }

        /* Specific atom label adjustments */
         .atom-label.N { fill: #1a237e; font-size: 15px; } /* Nitrogen - dark blue, slightly larger */
         .atom-label.Mg { fill: #388e3c; font-size: 18px; } /* Magnesium - green, larger */
         .atom-label.Fe { fill: #d32f2f; font-size: 18px; } /* Iron - red, larger */
         .atom-label.O { fill: #bf360c; font-size: 14px; } /* Oxygen - orange-red */


        /* Common parts highlighting */
        .common-bond {
            /* Default style for common bonds */
        }
         .common-atom-label {
            /* Default style for common atom labels */
        }


        /* --- Highlighting Animation --- */
        /* Flash (initial bright state) */
        .common-bond.flash, .double-bond.flash {
             stroke: #ffeb3b; /* Bright yellow */
             stroke-width: 4; /* Thicker flash */
        }
         .common-atom-label.flash {
            fill: #ffeb3b; /* Bright yellow */
        }

        /* Highlighted (final persistent state) */
        .common-bond.highlighted, .double-bond.highlighted {
             stroke: #ffc107; /* Amber */
             stroke-width: 3; /* Slightly thicker than default */
        }
        .common-atom-label.highlighted {
            fill: #ffc107; /* Amber */
        }

        /* Transition definition for the highlight */
        .bond.flash, .bond.highlighted,
        .double-bond.flash, .double-bond.highlighted,
        .atom-label.flash, .atom-label.highlighted {
             transition: stroke 0.3s ease-in-out, stroke-width 0.3s ease-in-out, fill 0.3s ease-in-out;
        }


        /* Optional: Non-common parts can be slightly faded or different color */
        .non-common .bond, .non-common .double-bond {
             stroke: #666;
             opacity: 0.8;
        }
         .non-common .atom-label {
             fill: #666;
             opacity: 0.8;
        }

        /* Instructions */
        .instructions {
            margin-top: 30px;
            font-size: 1.1em;
            color: #004d40;
            min-height: 1.5em; /* Reserve space to prevent layout shift */
        }

    </style>
</head>
<body>

    <h1>Comparing Chlorophyll and Hemoglobin</h1>
    <p>Drag Hemoglobin onto Chlorophyll to see their structural similarity!</p>

    <div class="container">
        <div id="chlorophyll-container" class="molecule-container">
            <h2>Chlorophyll (Core)</h2>
            <svg id="chlorophyll-svg" viewBox="-150 -150 300 300">
                <!-- Coordinates are simplified but aim for structural representation -->

                <!-- Common Chlorin/Porphyrin Core -->
                <!-- Note: Chlorophyll has a reduced double bond in one ring (Chlorin) -->
                <!-- We'll draw the porphyrin skeleton and slightly modify one ring -->
                <g class="porphyrin-core common">
                    <!-- Central Mg -->
                    <circle cx="0" cy="0" r="5" class="atom-label Mg"></circle>
                    <text x="0" cy="0" class="atom-label Mg">Mg</text>

                    <!-- Nitrogens (approximate positions around center) -->
                    <text x="55" cy="0" class="atom-label N">N</text>
                    <text x="-55" cy="0" class="atom-label N">N</text>
                    <text x="0" cy="55" class="atom-label N">N</text>
                    <text x="0" cy="-55" class="atom-label N">N</text>

                    <!-- Bonds from Mg to N -->
                    <line x1="0" y1="0" x2="50" y2="0" class="bond common-bond"></line>
                    <line x1="0" y1="0" x2="-50" y2="0" class="bond common-bond"></line>
                    <line x1="0" y1="0" x2="0" y2="50" class="bond common-bond"></line>
                    <line x1="0" y1="0" x2="0" y2="-50" class="bond common-bond"></line>

                    <!-- Porphyrin Skeleton (Simplified) -->
                    <!-- This is a simplified representation, not perfectly accurate bond lengths/angles -->
                    <!-- We'll use lines connecting approximate carbon positions (vertices) -->

                    <!-- Ring I (Top Right) -->
                    <line x1="55" y1="0" x2="70" y2="-20" class="bond common-bond"></line> <!-- N to Alpha C -->
                    <line x1="70" y1="-20" x2="60" y2="-45" class="bond common-bond"></line> <!-- Alpha C to Beta C -->
                    <line x1="60" y1="-45" x2="30" y2="-45" class="bond common-bond"></line> <!-- Beta C to Beta C -->
                    <line x1="30" y1="-45" x2="20" y2="-20" class="bond common-bond"></line> <!-- Beta C to Alpha C -->
                    <line x1="20" y1="-20" x2="55" y2="0" class="bond common-bond"></line> <!-- Alpha C back to N -->
                     <!-- Double bonds in Ring I -->
                    <line x1="65" y1="-32.5" x2="55" y2="-32.5" class="double-bond common-bond"></line>

                    <!-- Ring II (Bottom Right) -->
                     <line x1="55" y1="0" x2="70" y2="20" class="bond common-bond"></line> <!-- N to Alpha C -->
                    <line x1="70" y1="20" x2="60" y2="45" class="bond common-bond"></line> <!-- Alpha C to Beta C -->
                    <line x1="60" y1="45" x2="30" y2="45" class="bond common-bond"></line> <!-- Beta C to Beta C -->
                    <line x1="30" y1="45" x2="20" y2="20" class="bond common-bond"></line> <!-- Beta C to Alpha C -->
                    <line x1="20" y1="20" x2="55" y2="0" class="bond common-bond"></line> <!-- Alpha C back to N -->
                     <!-- Double bonds in Ring II -->
                    <line x1="35" y1="32.5" x2="45" y2="32.5" class="double-bond common-bond"></line>


                     <!-- Ring III (Bottom Left) - This ring is reduced in Chlorophyll -->
                     <line x1="-55" y1="0" x2="-70" y2="20" class="bond common-bond"></line> <!-- N to Alpha C -->
                    <line x1="-70" y1="20" x2="-60" y2="45" class="bond common-bond"></line> <!-- Alpha C to Beta C -->
                    <line x1="-60" y1="45" x2="-30" y2="45" class="bond common-bond non-common"></line> <!-- Beta C to Beta C -->
                    <line x1="-30" y1="45" x2="-20" y2="20" class="bond common-bond non-common"></line> <!-- Beta C to Alpha C -->
                    <line x1="-20" y1="20" x2="-55" y2="0" class="bond common-bond"></line> <!-- Alpha C back to N -->
                     <!-- No double bond in the center of Ring III in Chlorin -->


                     <!-- Ring IV (Top Left) -->
                     <line x1="-55" y1="0" x2="-70" y2="-20" class="bond common-bond"></line> <!-- N to Alpha C -->
                    <line x1="-70" y1="-20" x2="-60" y2="-45" class="bond common-bond"></line> <!-- Alpha C to Beta C -->
                    <line x1="-60" y1="-45" x2="-30" y2="-45" class="bond common-bond"></line> <!-- Beta C to Beta C -->
                    <line x1="-30" y1="-45" x2="-20" y2="-20" class="bond common-bond"></line> <!-- Beta C to Alpha C -->
                    <line x1="-20" y1="-20" x2="-55" y2="0" class="bond common-bond"></line> <!-- Alpha C back to N -->
                      <!-- Double bonds in Ring IV -->
                    <line x1="-35" y1="-32.5" x2="-45" y2="-32.5" class="double-bond common-bond"></line>


                    <!-- Methine Bridges (connecting Alpha Carbons) -->
                    <line x1="20" y1="-20" x2="25" y2="-35" class="bond common-bond"></line> <!-- Alpha C to Methine C -->
                    <line x1="20" y1="20" x2="25" y2="35" class="bond common-bond"></line> <!-- Alpha C to Methine C -->
                    <line x1="-20" y1="20" x2="-25" y2="35" class="bond common-bond"></line> <!-- Alpha C to Methine C -->
                    <line x1="-20" y1="-20" x2="-25" y2="-35" class="bond common-bond"></line> <!-- Alpha C to Methine C -->

                    <!-- Connecting Methine Carbons -->
                    <line x1="25" y1="-35" x2="-25" y2="-35" class="bond common-bond"></line> <!-- Top Methine -->
                    <line x1="25" y1="35" x2="-25" y2="35" class="bond common-bond"></line> <!-- Bottom Methine -->
                    <!-- Methine bonds to rings -->
                     <line x1="70" y1="-20" x2="85" y2="-10" class="bond common-bond"></line> <!-- Ring I Alpha C to Methine C -->
                     <line x1="70" y1="20" x2="85" y2="10" class="bond common-bond"></line> <!-- Ring II Alpha C to Methine C -->
                      <line x1="-70" y1="20" x2="-85" y2="10" class="bond common-bond"></line> <!-- Ring III Alpha C to Methine C -->
                     <line x1="-70" y1="-20" x2="-85" y2="-10" class="bond common-bond"></line> <!-- Ring IV Alpha C to Methine C -->
                     <!-- Connecting Methine Carbons -->
                    <line x1="85" y1="-10" x2="85" y2="10" class="bond common-bond"></line> <!-- Right Methine -->
                    <line x1="-85" y1="10" x2="-85" y2="-10" class="bond common-bond"></line> <!-- Left Methine -->


                     <!-- Conjugated Double Bonds in the Porphyrin system (simplified alternating pattern) -->
                     <!-- Bonds within rings (already added above) -->
                     <!-- Bonds along bridges (add second line for double bonds) -->
                     <line x1="80" y1="-10" x2="80" y2="10" class="double-bond common-bond"></line> <!-- Right bridge -->
                     <line x1="-80" y1="10" x2="-80" y2="-10" class="double-bond common-bond"></line> <!-- Left bridge -->
                     <line x1="25" y1="-40" x2="-25" y2="-40" class="double-bond common-bond"></line> <!-- Top bridge -->
                     <line x1="25" y1="40" x2="-25" y2="40" class="double-bond common-bond"></line> <!-- Bottom bridge -->


                </g>

                <!-- Non-common parts for Chlorophyll -->
                <g class="non-common">
                    <!-- Methyl groups (simplified as lines) -->
                    <line x1="30" y1="-45" x2="30" y2="-60" class="bond"></line> <!-- Ring I Beta C -->
                    <line x1="60" y1="-45" x2="75" y2="-55" class="bond"></line> <!-- Ring I Beta C -->

                    <line x1="30" y1="45" x2="30" y2="60" class="bond"></line> <!-- Ring II Beta C -->
                    <line x1="60" y1="45" x2="75" y2="55" class="bond"></line> <!-- Ring II Beta C -->

                     <line x1="-60" y1="-45" x2="-75" y2="-55" class="bond"></line> <!-- Ring IV Beta C -->


                    <!-- Vinyl group on Ring I Beta C -->
                    <line x1="30" y1="-45" x2="45" y2="-55" class="bond"></line>
                    <line x1="45" y1="-55" x2="60" y2="-55" class="bond"></line>
                    <line x1="55" y1="-55" x2="70" y2="-55" class="double-bond"></line> <!-- Double bond in Vinyl -->


                    <!-- Ethyl group on Ring IV Beta C -->
                     <line x1="-30" y1="-45" x2="-30" y2="-60" class="bond"></line>
                      <line x1="-30" y1="-60" x2="-45" y2="-70" class="bond"></line>


                    <!-- Fifth Ring (Isocyclic Ring) -->
                    <!-- Connects Ring III Alpha C to Beta C, with a carbonyl -->
                     <line x1="-20" y1="20" x2="-10" y2="50" class="bond"></line> <!-- From Ring III Alpha C -->
                     <line x1="-10" y1="50" x2="20" y2="50" class="bond"></line> <!-- Horizontal bond -->
                     <line x1="20" y1="50" x2="30" y2="45" class="bond"></line> <!-- To Ring II Beta C -->
                     <line x1="20" y1="50" x2="20" y2="65" class="double-bond"></line> <!-- Carbonyl double bond -->
                    <text x="20" y="75" class="atom-label O">O</text>

                    <!-- Methoxycarbonyl group (ester) -->
                    <line x1="-10" y1="50" x2="-10" y2="70" class="bond"></line> <!-- From fifth ring carbon -->
                    <text x="-10" y="80" class="atom-label O">O</text> <!-- Ester oxygen -->
                    <line x1="-10" y2="80" x2="-25" y2="90" class="bond"></line> <!-- Methyl group of ester -->


                    <!-- Phytyl Tail attachment point (simplified) -->
                    <!-- Attached to the propionic acid derivative off Ring IV Beta C -->
                    <line x1="-60" y1="45" x2="-60" y2="60" class="bond"></line> <!-- From Ring III Beta C -->
                    <line x1="-60" y1="60" x2="-75" y2="70" class="bond"></line> <!-- First CH2 -->
                    <line x1="-75" y2="70" x2="-75" y2="85" class="bond"></line> <!-- Second CH2 -->
                     <text x="-85" y2="95" class="atom-label O">O</text> <!-- Ester Oxygen linking to tail -->
                    <line x1="-75" y2="85" x2="-85" y2="95" class="bond"></line>

                    <!-- Adding a label for the phytyl tail attachment -->
                    <text x="-100" y="110" class="atom-label" font-size="10">Phytyl Tail</text>
                    <line x1="-85" y2="95" x2="-100" y2="110" class="bond non-common"></line>


                </g>

            </svg>
        </div>

        <div id="hemoglobin-container" class="molecule-container">
            <h2>Hemoglobin (Heme Group)</h2>
             <svg id="hemoglobin-svg" viewBox="-150 -150 300 300">
                 <!-- Coordinates are simplified but aim for structural representation -->

                <!-- Common Porphyrin Core -->
                <g class="porphyrin-core common">
                    <!-- Central Fe -->
                    <circle cx="0" cy="0" r="5" class="atom-label Fe"></circle>
                    <text x="0" cy="0" class="atom-label Fe">Fe</text>

                    <!-- Nitrogens (approximate positions around center) -->
                    <text x="55" cy="0" class="atom-label N">N</text>
                    <text x="-55" cy="0" class="atom-label N">N</text>
                    <text x="0" cy="55" class="atom-label N">N</text>
                    <text x="0" cy="-55" class="atom-label N">N</text>

                     <!-- Bonds from Fe to N -->
                    <line x1="0" y1="0" x2="50" y2="0" class="bond common-bond"></line>
                    <line x1="0" y1="0" x2="-50" y2="0" class="bond common-bond"></line>
                    <line x1="0" y1="0" x2="0" y2="50" class="bond common-bond"></line>
                    <line x1="0" y1="0" x2="0" y2="-50" class="bond common-bond"></line>


                    <!-- Porphyrin Skeleton (Simplified) - Fully conjugated -->
                    <!-- Ring I (Top Right) -->
                    <line x1="55" y1="0" x2="70" y2="-20" class="bond common-bond"></line> <!-- N to Alpha C -->
                    <line x1="70" y1="-20" x2="60" y2="-45" class="bond common-bond"></line> <!-- Alpha C to Beta C -->
                    <line x1="60" y1="-45" x2="30" y2="-45" class="bond common-bond"></line> <!-- Beta C to Beta C -->
                    <line x1="30" y1="-45" x2="20" y2="-20" class="bond common-bond"></line> <!-- Beta C to Alpha C -->
                    <line x1="20" y1="-20" x2="55" y2="0" class="bond common-bond"></line> <!-- Alpha C back to N -->
                     <!-- Double bonds in Ring I -->
                    <line x1="65" y1="-32.5" x2="55" y2="-32.5" class="double-bond common-bond"></line>


                    <!-- Ring II (Bottom Right) -->
                     <line x1="55" y1="0" x2="70" y2="20" class="bond common-bond"></line> <!-- N to Alpha C -->
                    <line x1="70" y1="20" x2="60" y2="45" class="bond common-bond"></line> <!-- Alpha C to Beta C -->
                    <line x1="60" y1="45" x2="30" y2="45" class="bond common-bond"></line> <!-- Beta C to Beta C -->
                    <line x1="30" y1="45" x2="20" y2="20" class="bond common-bond"></line> <!-- Beta C to Alpha C -->
                    <line x1="20" y1="20" x2="55" y2="0" class="bond common-bond"></line> <!-- Alpha C back to N -->
                     <!-- Double bonds in Ring II -->
                    <line x1="35" y1="32.5" x2="45" y2="32.5" class="double-bond common-bond"></line>


                     <!-- Ring III (Bottom Left) - Fully conjugated in Hemoglobin -->
                     <line x1="-55" y1="0" x2="-70" y2="20" class="bond common-bond"></line> <!-- N to Alpha C -->
                    <line x1="-70" y1="20" x2="-60" y2="45" class="bond common-bond"></line> <!-- Alpha C to Beta C -->
                    <line x1="-60" y1="45" x2="-30" y2="45" class="bond common-bond"></line> <!-- Beta C to Beta C -->
                    <line x1="-30" y1="45" x2="-20" y2="20" class="bond common-bond"></line> <!-- Beta C to Alpha C -->
                    <line x1="-20" y1="20" x2="-55" y2="0" class="bond common-bond"></line> <!-- Alpha C back to N -->
                     <!-- Double bonds in Ring III -->
                     <line x1="-65" y1="32.5" x2="-55" y1="32.5" class="double-bond common-bond"></line>


                     <!-- Ring IV (Top Left) -->
                     <line x1="-55" y1="0" x2="-70" y2="-20" class="bond common-bond"></line> <!-- N to Alpha C -->
                    <line x1="-70" y1="-20" x2="-60" y2="-45" class="bond common-bond"></line> <!-- Alpha C to Beta C -->
                    <line x1="-60" y1="-45" x2="-30" y2="-45" class="bond common-bond"></line> <!-- Beta C to Beta C -->
                    <line x1="-30" y1="-45" x2="-20" y2="-20" class="bond common-bond"></line> <!-- Beta C to Alpha C -->
                    <line x1="-20" y1="-20" x2="-55" y2="0" class="bond common-bond"></line> <!-- Alpha C back to N -->
                      <!-- Double bonds in Ring IV -->
                    <line x1="-35" y1="-32.5" x2="-45" y1="-32.5" class="double-bond common-bond"></line>


                    <!-- Methine Bridges (connecting Alpha Carbons) -->
                    <line x1="20" y1="-20" x2="25" y2="-35" class="bond common-bond"></line> <!-- Alpha C to Methine C -->
                    <line x1="20" y1="20" x2="25" y2="35" class="bond common-bond"></line> <!-- Alpha C to Methine C -->
                    <line x1="-20" y1="20" x2="-25" y2="35" class="bond common-bond"></line> <!-- Alpha C to Methine C -->
                    <line x1="-20" y1="-20" x2="-25" y2="-35" class="bond common-bond"></line> <!-- Alpha C to Methine C -->

                    <!-- Connecting Methine Carbons -->
                    <line x1="25" y1="-35" x2="-25" y2="-35" class="bond common-bond"></line> <!-- Top Methine -->
                    <line x1="25" y1="35" x2="-25" y2="35" class="bond common-bond"></line> <!-- Bottom Methine -->
                    <!-- Methine bonds to rings -->
                     <line x1="70" y1="-20" x2="85" y2="-10" class="bond common-bond"></line> <!-- Ring I Alpha C to Methine C -->
                     <line x1="70" y1="20" x2="85" y2="10" class="bond common-bond"></line> <!-- Ring II Alpha C to Methine C -->
                      <line x1="-70" y1="20" x2="-85" y2="10" class="bond common-bond"></line> <!-- Ring III Alpha C to Methine C -->
                     <line x1="-70" y1="-20" x2="-85" y2="-10" class="bond common-bond"></line> <!-- Ring IV Alpha C to Methine C -->
                     <!-- Connecting Methine Carbons -->
                    <line x1="85" y1="-10" x2="85" y2="10" class="bond common-bond"></line> <!-- Right Methine -->
                    <line x1="-85" y1="10" x2="-85" y2="-10" class="bond common-bond"></line> <!-- Left Methine -->


                     <!-- Conjugated Double Bonds in the Porphyrin system (alternating pattern) -->
                     <!-- Bonds within rings (already added above) -->
                     <!-- Bonds along bridges (add second line for double bonds) -->
                     <line x1="80" y1="-10" x2="80" y2="10" class="double-bond common-bond"></line> <!-- Right bridge -->
                     <line x1="-80" y1="10" x2="-80" y2="-10" class="double-bond common-bond"></line> <!-- Left bridge -->
                     <line x1="25" y1="-40" x2="-25" y2="-40" class="double-bond common-bond"></line> <!-- Top bridge -->
                     <line x1="25" y1="40" x2="-25" y2="40" class="double-bond common-bond"></line> <!-- Bottom bridge -->


                </g>

                <!-- Non-common parts for Hemoglobin (Heme) -->
                <g class="non-common">
                     <!-- Methyl groups (simplified as lines) -->
                    <line x1="30" y1="-45" x2="30" y2="-60" class="bond"></line> <!-- Ring I Beta C -->
                    <line x1="60" y1="-45" x2="75" y2="-55" class="bond"></line> <!-- Ring I Beta C -->

                    <line x1="-30" y1="45" x2="-30" y2="60" class="bond"></line> <!-- Ring III Beta C -->
                    <line x1="-60" y1="45" x2="-75" y2="55" class="bond"></line> <!-- Ring III Beta C -->


                    <!-- Vinyl group on Ring II Beta C -->
                    <line x1="30" y1="45" x2="45" y2="55" class="bond"></line>
                    <line x1="45" y1="55" x2="60" y2="55" class="bond"></line>
                    <line x1="55" y1="55" x2="70" y2="55" class="double-bond"></line> <!-- Double bond in Vinyl -->

                    <!-- Vinyl group on Ring IV Beta C -->
                     <line x1="-30" y1="-45" x2="-45" y2="-55" class="bond"></line>
                    <line x1="-45" y1="-55" x2="-60" y2="-55" class="bond"></line>
                    <line x1="-55" y1="-55" x2="-70" y1="-55" class="double-bond"></line> <!-- Double bond in Vinyl -->

                    <!-- Propionic acid on Ring II Beta C -->
                    <line x1="60" y1="45" x2="60" y2="60" class="bond"></line> <!-- CH2 -->
                    <line x1="60" y1="60" x2="75" y2="70" class="bond"></line> <!-- CH2 -->
                     <line x1="75" y2="70" x2="90" y2="70" class="bond"></line> <!-- Carboxyl C -->
                     <line x1="90" y2="70" x2="100" y2="60" class="bond"></line> <!-- O bond -->
                     <text x="105" y="60" class="atom-label O">O</text>
                     <line x1="90" y2="70" x2="100" y2="80" class="double-bond"></line> <!-- Carbonyl O -->
                     <text x="105" y="80" class="atom-label O">O</text>


                    <!-- Propionic acid on Ring III Beta C -->
                     <line x1="-60" y1="45" x2="-60" y2="60" class="bond"></line> <!-- CH2 -->
                    <line x1="-60" y1="60" x2="-75" y2="70" class="bond"></line> <!-- CH2 -->
                     <line x1="-75" y2="70" x2="-90" y2="70" class="bond"></line> <!-- Carboxyl C -->
                     <line x1="-90" y2="70" x2="-100" y2="60" class="bond"></line> <!-- O bond -->
                     <text x="-105" y="60" class="atom-label O">O</text>
                     <line x1="-90" y2="70" x2="-100" y2="80" class="double-bond"></line> <!-- Carbonyl O -->
                     <text x="-105" y="80" class="atom-label O">O</text>


                    <!-- Protein attachment point (axial ligand, simplified) -->
                     <line x1="0" y1="0" x2="0" y2="-80" class="bond non-common"></line> <!-- Bond to axial ligand -->
                      <text x="0" y="-90" class="atom-label non-common" font-size="12">Protein</text> <!-- Label -->

                </g>

            </svg>
        </div>
    </div>

     <p class="instructions" id="instructions">Drag the Hemoglobin (Heme) molecule towards the Chlorophyll molecule.</p>


    <script>
        const hemoglobinContainer = document.getElementById('hemoglobin-container');
        const chlorophyllContainer = document.getElementById('chlorophyll-container');
        // Select the metal atom labels for calculating center
        const chlorophyllMg = chlorophyllContainer.querySelector('.atom-label.Mg');
        const hemoglobinFe = hemoglobinContainer.querySelector('.atom-label.Fe');
        const instructions = document.getElementById('instructions');

        let isDragging = false;
        let initialX;
        let initialY;
        let xOffset = 0;
        let yOffset = 0;
        let snapped = false;

        // Function to get the center coordinates of an element relative to the viewport
        function getElementCenter(element) {
            const rect = element.getBoundingClientRect();
            // For text elements or small circles representing atoms, the center is approximately rect.left + width/2, rect.top + height/2
             // For the central metal ion, the circle element's center *is* its cx/cy relative to its SVG,
             // but we need its viewport position. getBoundingClientRect() is the most reliable way
             // to get the element's position relative to the viewport.
            return {
                x: rect.left + rect.width / 2,
                y: rect.top + rect.height / 2
            };
        }

        // Function to calculate distance between two points
        function getDistance(p1, p2) {
            const dx = p1.x - p2.x;
            const dy = p1.y - p2.y;
            return Math.sqrt(dx * dx + dy * dy);
        }

        function dragStart(e) {
            if (snapped) return; // Don't drag if already snapped

            // Ensure the target is the container itself or something within it
            if (!hemoglobinContainer.contains(e.target)) {
                 return;
            }

            // Handle touch events
            if (e.type === 'touchstart') {
                e.preventDefault(); // Prevent default touch behavior (scrolling, zooming)
                const touch = e.touches[0];
                 // Calculate initial offsets based on current position
                 const rect = hemoglobinContainer.getBoundingClientRect();
                 xOffset = touch.clientX - rect.left;
                 yOffset = touch.clientY - rect.top;

                 initialX = touch.clientX;
                 initialY = touch.clientY;

            } else { // Handle mouse events
                 // Calculate initial offsets based on current position
                 const rect = hemoglobinContainer.getBoundingClientRect();
                 xOffset = e.clientX - rect.left;
                 yOffset = e.clientY - rect.top;

                 initialX = e.clientX;
                 initialY = e.clientY;
            }

            isDragging = true;
            hemoglobinContainer.classList.add('dragging');

            // Set initial position for absolute positioning if not already set
            // Or more reliably, ensure position is absolute and record current offsets
             if (hemoglobinContainer.style.position !== 'absolute') {
                const rect = hemoglobinContainer.getBoundingClientRect();
                hemoglobinContainer.style.position = 'absolute';
                hemoglobinContainer.style.left = rect.left + 'px';
                hemoglobinContainer.style.top = rect.top + 'px';
                 // Recalculate offsets based on the just-set absolute position
                 if (e.type === 'touchstart') {
                      const touch = e.touches[0];
                     xOffset = touch.clientX - parseFloat(hemoglobinContainer.style.left);
                     yOffset = touch.clientY - parseFloat(hemoglobinContainer.style.top);
                 } else {
                    xOffset = e.clientX - parseFloat(hemoglobinContainer.style.left);
                    yOffset = e.clientY - parseFloat(hemoglobinContainer.style.top);
                 }
            }

             // Bring the dragged element to the front (higher z-index)
             hemoglobinContainer.style.zIndex = 100;

        }

        function dragEnd() {
            if (!isDragging) return;

            isDragging = false;
            hemoglobinContainer.classList.remove('dragging');
             // Reset z-index after drag ends, unless snapped
             if (!snapped) {
                 hemoglobinContainer.style.zIndex = 10; // Or whatever default z-index
             }


            // Check for snap condition when dragging ends
             checkSnap();
        }

        function drag(e) {
            if (!isDragging || snapped) return;

             // Handle touch events
            let currentX, currentY;
             if (e.type === 'touchmove') {
                e.preventDefault(); // Prevent default touch behavior
                if (e.touches.length === 0) return; // Should not happen, but safety
                currentX = e.touches[0].clientX;
                currentY = e.touches[0].clientY;
            } else { // Handle mouse events
                currentX = e.clientX;
                currentY = e.clientY;
            }

            // Calculate new position relative to the initial click/touch point within the element
            const newLeft = currentX - xOffset;
            const newTop = currentY - yOffset;


            hemoglobinContainer.style.left = newLeft + 'px';
            hemoglobinContainer.style.top = newTop + 'px';

        }

        function checkSnap() {
             if (snapped) return;

             const mgCenter = getElementCenter(chlorophyllMg);
             const feCenter = getElementCenter(hemoglobinFe);

             const snapThreshold = 60; // Pixels - adjust this value based on desired snap radius (smaller threshold needed with more detailed diagrams)

             const distance = getDistance(mgCenter, feCenter);

             if (distance < snapThreshold) {
                 snapped = true;
                 hemoglobinContainer.classList.add('snapped');
                  hemoglobinContainer.style.zIndex = 5; // Lower z-index slightly after snapping if desired

                 // Calculate the required translation to align centers
                 const currentFeCenter = getElementCenter(hemoglobinFe); // Recalculate Fe center in its *current* position

                 // We want the Fe center to move to the Mg center's position
                 // The target position for the CONTAINER is its current left/top PLUS the difference needed to move the Fe center
                 const targetLeft = parseFloat(hemoglobinContainer.style.left) + (mgCenter.x - currentFeCenter.x);
                 const targetTop = parseFloat(hemoglobinContainer.style.top) + (mgCenter.y - currentFeCenter.y);

                 // Apply the target position with transition
                 hemoglobinContainer.style.left = targetLeft + 'px';
                 hemoglobinContainer.style.top = targetTop + 'px';

                 // Trigger highlight
                 highlightCommonParts();

                 // Update instructions
                 instructions.textContent = "The common core structures (Porphyrin/Chlorin Ring) are highlighted!";
                 instructions.style.color = '#004d40'; // Dark green text
                 instructions.style.fontWeight = 'bold';
             }
        }

        function highlightCommonParts() {
            // Select elements with the common classes in BOTH containers
            const commonElementsChlorophyll = chlorophyllContainer.querySelectorAll('.porphyrin-core.common .common-bond, .porphyrin-core.common .double-bond, .porphyrin-core.common .atom-label');
            const commonElementsHemoglobin = hemoglobinContainer.querySelectorAll('.porphyrin-core.common .common-bond, .porphyrin-core.common .double-bond, .porphyrin-core.common .atom-label');

            const allCommonElements = [...commonElementsChlorophyll, ...commonElementsHemoglobin];

            // Add flash class to trigger the rapid transition to bright color/width
            allCommonElements.forEach(el => {
                el.classList.add('flash');
            });

            // After a short delay, remove flash and add highlighted class
            setTimeout(() => {
                allCommonElements.forEach(el => {
                    el.classList.remove('flash');
                    el.classList.add('highlighted');
                });
            }, 300); // Flash duration before fading to highlighted state (adjust timing if needed)
        }


         // --- Initial Positioning ---
         // Set the initial position of the draggable hemoglobin
         // We need to do this *after* the page layout is stable
        window.addEventListener('load', () => {
             const chloroRect = chlorophyllContainer.getBoundingClientRect();
             const hemoRect = hemoglobinContainer.getBoundingClientRect();
             const containerRect = document.querySelector('.container').getBoundingClientRect();


             // Position Hemoglobin to the right of Chlorophyll initially
             // Calculate position relative to the *container* for absolute positioning
             const initialLeft = chloroRect.right + 50 - containerRect.left; // 50px gap + relative to container
             const initialTop = chloroRect.top - containerRect.top; // Align tops + relative to container

             hemoglobinContainer.style.position = 'absolute';
             hemoglobinContainer.style.left = initialLeft + 'px';
             hemoglobinContainer.style.top = initialTop + 'px';

             // Initial state does not have transition
             requestAnimationFrame(() => {
                 hemoglobinContainer.style.transition = 'left 0.5s ease-out, top 0.5s ease-out, box-shadow 0.5s ease';
             });

        });


        // --- Event Listeners ---
        // Mouse events
        hemoglobinContainer.addEventListener('mousedown', dragStart, false);
        document.addEventListener('mouseup', dragEnd, false); // Listen on document to catch release outside the element
        document.addEventListener('mousemove', drag, false);

        // Touch events
        hemoglobinContainer.addEventListener('touchstart', dragStart, { passive: false }); // Use passive: false for preventDefault
        document.addEventListener('touchend', dragEnd, false); // Listen on document
        document.addEventListener('touchmove', drag, { passive: false }); // Use passive: false for preventDefault


    </script>

</body>
</html>
